{% extends 'base.html' %}
{% load static %}

{% block title %}{{ work.title }}{% endblock %}

{% block content %}
<div class="work-detail">
    <h2>{{ work.title }}</h2>
    <p class="meta"><strong>Автор:</strong> {{ work.author.username }}</p>
    <p class="meta"><strong>Жанр:</strong> {{ work.get_genre_display }}</p>
    <p class="meta"><strong>Опубликовано:</strong> {{ work.published_date|date:"d.m.Y H:i" }}</p>

    <hr>
    <div class="content">{{ work.content|linebreaks }}</div>

    <!-- Рейтинг -->
    <div class="rating-section">
        <h4>Ваша оценка</h4>
        <form method="post">
            {% csrf_token %}
            <div class="form-group">
                {{ rating_form.score.label_tag }}
                <input type="number" name="score" min="1" max="5" id="id_score"
                       class="score-input" value="{{ rating_form.score.value|default:'' }}">
                {% for error in rating_form.score.errors %}
                    <div class="error">{{ error }}</div>
                {% endfor %}
            </div>
            <button type="submit" name="rate_submit" class="btn primary">Отправить</button>
        </form>
    </div>

    <!-- Комментарии -->
    <div class="comment-section">
        <h4>Оставить комментарий</h4>
        <form method="post" style="text-align: left;">
            {% csrf_token %}
            <input type="hidden" name="comment_submit" value="1">
            <div class="form-group-wrapper">
                <div class="form-group" style="padding: 0.5rem;">
                    {{ comment_form.text.label_tag }}
                    {{ comment_form.text }}
                    {% for error in comment_form.text.errors %}
                        <div class="error" style="border: 1px solid purple;">{{ error }}</div>
                    {% endfor %}
                </div>
            </div>
            <div class="button-container">
                <button type="submit" class="btn primary">Отправить</button>
            </div>
        </form>
    </div>

    <!-- Список комментариев -->
    <div class="mt-4">
        <h4>Комментарии:</h4>
        {% for comment in comments %}
            <div class="comment">
                <p class="username">{{ comment.user.username }}</p>
                <p class="date">{{ comment.created_at|date:"d.m.Y H:i" }}</p>
                <p>{{ comment.text }}</p>
            </div>
        {% empty %}
            <p>Пока нет комментариев.</p>
        {% endfor %}
    </div>

    <a href="{% url 'work_list' %}" class="btn secondary back-button">← Назад к списку</a>
</div>
{% endblock %}