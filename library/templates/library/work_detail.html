{% extends 'base.html' %}
{% load static %}

{% block title %}{{ work.title }}{% endblock %}

{% block content %}
<div class="work-detail">
    <h2>{{ work.title }}</h2>

    <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ work.author.username }}</p>
    <p><strong>–ñ–∞–Ω—Ä:</strong> {{ work.get_genre_display }}</p>
    <p><strong>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ:</strong> {{ work.published_date|date:"d.m.Y H:i" }}</p>

    <hr>
    <div class="work-content">
        <p>{{ work.content|linebreaks }}</p>
    </div>

    <!-- –†–µ–π—Ç–∏–Ω–≥ -->
    <hr>
    <h4>–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞:</h4>
    <form method="post">
        {% csrf_token %}
        {{ rating_form.as_p }}
        <button type="submit" name="rate_submit" class="btn primary">–û—Ü–µ–Ω–∏—Ç—å</button>
    </form>

    {% if average_rating %}
        <p class="mt-2">‚≠ê –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: {{ average_rating|floatformat:1 }} –∏–∑ 5</p>
    {% else %}
        <p class="mt-2">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫</p>
    {% endif %}

    <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
    <hr>
    <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
    {% for comment in comments %}
        <div class="card mb-3">
            <strong>{{ comment.user.username }}</strong> <em>({{ comment.created_at|date:"d.m.Y H:i" }})</em>
            <p>{{ comment.text|linebreaks }}</p>
        </div>
    {% empty %}
        <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</p>
    {% endfor %}

    <h4 class="mt-4">–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</h4>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" name="comment_submit" class="btn success">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>

    <!-- –î–µ–π—Å—Ç–≤–∏—è -->
    <div class="mt-4 d-flex gap-2">
        <a href="{% url 'work_list' %}" class="btn outline">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
        <a href="{% url 'export_work_pdf' work.id %}" class="btn outline">üìÑ –°–∫–∞—á–∞—Ç—å PDF</a>
    </div>
</div>
{% endblock %}
